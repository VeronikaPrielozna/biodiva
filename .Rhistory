if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11, col = col, bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
textA<-"Absolute proportion of species richness for classes of dominance: "
textB<-"Relative proportion of species richness for classes of dominance: "
textA1<-"Total number of species"
textB1<-"Relative frequency"
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
print(textA1)
print(tableA)
print(maxA)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6), col = col, xaxt = "n")
# , ylim = c(0,maxA + 5), ylab = textA1,
#         args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
#         col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11, col = c("gray0", "gray48", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
textA<-"Absolute proportion of species richness for classes of dominance: "
textB<-"Relative proportion of species richness for classes of dominance: "
textA1<-"Total number of species"
textB1<-"Relative frequency"
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11, col = c("gray0", "gray48", "gray84", "gray90", "gray98"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
textA<-"Absolute proportion of species richness for classes of dominance: "
textB<-"Relative proportion of species richness for classes of dominance: "
textA1<-"Total number of species"
textB1<-"Relative frequency"
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11, col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
textA<-"Absolute proportion of species richness for classes of dominance: "
textB<-"Relative proportion of species richness for classes of dominance: "
textA1<-"Total number of species"
textB1<-"Relative frequency"
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11,
textA = "Absolute proportion of species richness for classes of dominance: ",
textB = "Relative proportion of species richness for classes of dominance: ",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 11,
textA = "Absolute proportion of species richness for classes of dominance: ",
textB = "Relative proportion of species richness for classes of dominance: ",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 12,
textA = "Absolute proportion of species richness for classes of dominance: ",
textB = "Relative proportion of species richness for classes of dominance: ",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
}
Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 12,
textA = "Absolute proportion of species richness for classes of dominance: ",
textB = "Relative proportion of species richness for classes of dominance: ",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
if (table == 1){
cat(paste(textA, "\n\n"))
print(tableA)
cat("\n")
cat(paste(textB, "\n\n"))
print(tableR)
table1 <-list(textA = tableA, textB = tableR)
return(table1)
}
if (table == 2){
cat(paste(textA, "\n\n"))
print(tableA)
}
if (table == 3){
cat(paste(textB, "\n\n"))
print(tableR)
}
}
Dominance(test_data)
<vytup-Dominance(test_data)
vytup<-Dominance(test_data)
Dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 12,
textA = "Absolute proportion of species richness for classes of dominance: ",
textB = "Relative proportion of species richness for classes of dominance: ",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
if (table == 1){
table1 <-list( "Absolute proportion" = tableA, "Relative proportion" = tableR)
return(table1)
}
if (table == 2){
cat(paste(textA, "\n\n"))
return(tableA)
}
if (table == 3){
cat(paste(textB, "\n\n"))
return(tableR)
}
}
vytup<-Dominance(test_data)
Dominance(test_data, table = 2)
BrokenStick<-function(x, first.col = 2, table=T, graph = T){
x<-x[,first.col:ncol(x)]
data.abund<-x
S<-sum(apply(x, 1, sum, na.rm = TRUE)>0)
N<-apply(x, 2, sum, na.rm = TRUE)
Bs<-rep(0,S)
N<-sum(data.abund)
for (i in 1:S) {
Bs[i]<-sum(1/(i:S))/S * N
}
Bst<-data.frame(Bs)
Bst<-cbind(Bst, new_col = log10(Bs))
colnames(Bst)<-c("Bs", "Log10(Bs)")
Bst<-round(Bst, digits = 2)
if (graph == T){
par(mfrow=c(2,1), mar=c(3,4,1,0.3))
maxB1<-max(Bs)
maxB2<-max(Bst[,2])
minB<-min(Bst[,2])
plot(Bs, xlab = " ", ylim = c(0, maxB1 + 2), xlim = c(0,S))
plot(log10(Bs), xlab = " ", ylim = c(minB, maxB2 + 0.2), xlim = c(0,S))
}
if (table==T){
return(Bst)
}
}
BrokenStick(test_data)
BrokenStick<-function(x, first.col = 2, table=T, graph = T, ...){
x<-x[,first.col:ncol(x)]
data.abund<-x
S<-sum(apply(x, 1, sum, na.rm = TRUE)>0)
N<-apply(x, 2, sum, na.rm = TRUE)
Bs<-rep(0,S)
N<-sum(data.abund)
for (i in 1:S) {
Bs[i]<-sum(1/(i:S))/S * N
}
Bst<-data.frame(Bs)
Bst<-cbind(Bst, new_col = log10(Bs))
colnames(Bst)<-c("Bs", "Log10(Bs)")
Bst<-round(Bst, digits = 2)
if (graph == T){
par(mfrow=c(2,1), mar=c(3,4,1,0.3), las = 2)
maxB1<-max(Bs)
maxB2<-max(Bst[,2])
minB<-min(Bst[,2])
plot(Bs, xlab = " ", ylim = c(0, maxB1 + 2), xlim = c(0,S))
plot(log10(Bs), xlab = " ", ylim = c(minB, maxB2 + 0.2), xlim = c(0,S))
}
if (table==T){
return(Bst)
}
}
BrokenStick(test_data, las = 1)
BrokenStick<-function(x, first.col = 2, table=T, graph = T, ...){
x<-x[,first.col:ncol(x)]
data.abund<-x
S<-sum(apply(x, 1, sum, na.rm = TRUE)>0)
N<-apply(x, 2, sum, na.rm = TRUE)
Bs<-rep(0,S)
N<-sum(data.abund)
for (i in 1:S) {
Bs[i]<-sum(1/(i:S))/S * N
}
Bst<-data.frame(Bs)
Bst<-cbind(Bst, new_col = log10(Bs))
colnames(Bst)<-c("Bs", "Log10(Bs)")
Bst<-round(Bst, digits = 2)
if (graph == T){
par(mfrow=c(2,1), mar=c(3,4,1,0.3), las = 2)
maxB1<-max(Bs)
maxB2<-max(Bst[,2])
minB<-min(Bst[,2])
plot(Bs, ylim = c(0, maxB1 + 2), xlim = c(0,S))
plot(log10(Bs), ylim = c(minB, maxB2 + 0.2), xlim = c(0,S))
}
if (table==T){
return(Bst)
}
}
BrokenStick(test_data, las = 1)
sd.eco<-function(x, first.col = 2, table = 1, graph = 1, pos_leg = 8.5){
x<-x[,first.col:ncol(x)]
# Species richness
F1<-apply(x, 2, function(f1) sum(f1==1))
F2<-apply(x, 2, function(f2) sum(f2==2))
Other<-apply(x, 2, function(f4) sum(f4>2))
Total<-F1 + F2 + Other
table1<-rbind(F1,F2,Other,Total)
maxS<-max(table1[1,] + table1[2,])
maxS2<-max(table1[4,])
# Abundance
TotalA<-apply(x, 2, function(f5) sum(f5))
F2A<-F2*2
OtherA<-TotalA-F1-F2A
table2<-rbind(F1,F2A,OtherA,TotalA)
rownames(table2)<-c("F1", "F2", "Other", "Total")
maxA<-max(table2[1,] + table2[2,])
maxA2<-max(table2[4,])
if (table == 1){
print("Species richness")
print(table1)
print(" ")
print("Abundance")
print(table2)
}
if (table == 2){
print("Species richness")
print(table1)
}
if (table == 3){
print("Abundance")
print(table2)
}
if(graph == 1){
par(mfrow=c(2,1), mar=c(3.5,5,0.3,0.3))
posgr = barplot(table1, plot = F)
barplot(table1[-c(3,4),], ylim = c(0,maxS + 5),las = 2, ylab = "Number of species", xaxt = "n",
legend.text = c("F1", "F2"), col = c( "lightcyan4", "lightcyan3"),
args.legend = list(bty = "n", x = pos_leg, y = -4, ncol = 3))
text(posgr, F1+F2, lab=Total, cex=0.9, pos=3)
posgr = barplot(table2, plot = F)
barplot(table2[-c(3,4),], ylim = c(0,maxA + 5),las = 2, las = 2, ylab = "Abundance",
legend = F, col = c("lightcyan4", "lightcyan3"))
text(posgr, F1+2*F2, lab = TotalA, cex=0.9, pos=3)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5))
posgr = barplot(table1, plot = F)
barplot(table1[-4,], ylim = c(0,maxS2 + 5), las = 2, ylab = "Number of species",
legend.text = c("F1", "F2", "Other"), col = c("lightcyan4", "lightcyan3","azure2"),
args.legend = list(bty = "n", x = pos_leg, y = maxS2 + 7, ncol = 3))
text(posgr, Total, lab=Total, cex=0.9, pos=3)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5))
posgr = barplot(table2, plot = F)
barplot(table2[-4,], ylim = c(0, maxA2 + 30), las = 2, ylab = "Abundance",
legend.text = c("F1", "F2", "Other"), col = c("lightcyan4", "lightcyan3","azure2"),
args.legend = list(bty = "n", x = pos_leg, y = maxA2+20, ncol = 3))
text(posgr, TotalA, lab=TotalA, cex=0.9, pos=3)
}
}
LoadData<-function(file="clipboard",first.col=2, na2null=T, attrib=T) {
cat(paste("Copy data into cliboard."))
invisible(readline(prompt="Press [enter] to continue. "))
tryCatch(silent=T,
expr = {
x<-read.table(file, h=T, sep = "\t")
message("Dataset successfully uploaded.")
},
error = function(e){
message("Dataset inaccurately uploaded, Try again.")
print(e)
},
warning = function(w){
message("Warning! Dataset inaccurately uploaded. Try again.")
print(w)
},
finally = {
attr(x,"Spec_col")<-first.col:ncol(x)
attr(x, "Number of species")<-nrow(x)
attr(x,"Number of samples")<-ncol(x)-1
y<-unlist(lapply(as.list(first.col:ncol(x)),function(x1) is.numeric((x[,x1]))))
if(all(y, na.rm = TRUE)==F){
colbad<-which(y==FALSE) + first.col-1
cat(paste("Samples",paste(names(x)[colbad],collapse=","),"are not numeric"))
cat("\n")
answ=readline(prompt="Continue and skip non-numeric columns? y/n  ")
if(answ=="y") x<-x[-colbad] else stop(paste("Function was terminated. Try to fix the dataset."))
}
if(na2null==T) x[is.na(x)]<-0
if (attrib==T){
print("Attributes of table")
print(attributes(x))
}
cat(paste("Short data:"), "\n")
print(x[1:5,])
cat("\n")
message("You can continue.")
}
)
return(x)
}
install.packages("available")
library(available)
available::available("biodiva")
