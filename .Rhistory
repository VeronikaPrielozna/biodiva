print(S)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 1)
boxplot(S~table1[3,])
}
return(table1)
}
Chaovysl<-Chao1(test_dat)
Chao1<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
F1<-apply(x, 2, function(f1) sum(f1==1))
F2<-apply(x, 2, function(f2) sum(f2==2))
S<-apply(x, 2, function(x1) sum(x1>0))
Sobs<-(F1^2)/(2*F2)
table1<-rbind(F1,F2,Sobs)
rownames(table1)<-c("F1", "F2", "Chao1")
table1<-round(table1, digits = 2)
print(table1)
print(S)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 1)
plot(S~table1[3,])
}
return(table1)
}
Chaovysl<-Chao1(test_dat)
Abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
# if (graph == T){
#   par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
#   posgr = barplot(Atab, plot = F)
#   barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 + 30), col = col,
#           args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
#   text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
# }
# return(Atab)
ui <- fluidPage(
# Application title
titlePanel("Znečištění"),
# Sidebar with a slider input for number of bins
sidebarLayout(
sidebarPanel(
sliderInput("rozsah",
"Rozsah:",
min = 1,
max = nrow(Atab),
value = c(1, nrow(Atab))),
selectInput("promenna",
"Proměnná:",
choices = c("PM10", "NOx", "SO2")),
checkboxInput("log",
"Logaritmická transformace")
),
mainPanel(
tabsetPanel(
tabPanel("Graf",
plotOutput("distPlot"),
p("Počet vybraných řádků:", textOutput("pocet"))),
tabPanel("Tabulka", dataTableOutput("tabulka"))
)
)
)
)
# Define server logic required to draw a histogram
server <- function(input, output) {
vybranaData <- reactive({
i <- seq(from = input$rozsah[1], to = input$rozsah[2])
d <- data.frame(id = data$id,
y = data[[input$promenna]])
d <- d[i, ]
if (input$log){
d$y <- log(d$y)
}
return(d)
})
nazev <- reactive({
n <- input$promenna
if (input$log){
n <- paste0('log(', n, ')')
}
return(n)
})
output$pocet <- renderText({
d <- vybranaData()
return(nrow(d))
})
output$distPlot <- renderPlot({
d <- vybranaData()
g <- ggplot(d) +
aes(x = id, y = y) +
geom_line() +
ylab(nazev())
return(g)
})
output$tabulka <- renderDataTable({
i <- seq(from = input$rozsah[1], to = input$rozsah[2])
data[i,]
})
}
# Run the application
shinyApp(ui = ui, server = server)
}
Abundance()
LoadData<-function(file="clipboard",first.col=2, na2null=T, attrib=T) {
cat(paste("Copy data into cliboard."))
invisible(readline(prompt="Press [enter] to continue. "))
tryCatch(silent=T,
expr = {
x<-read.table(file, h=T, sep = "\t")
message("Dataset successfully uploaded.")
},
error = function(e){
message("Dataset inaccurately uploaded, Try again.")
print(e)
},
warning = function(w){
message("Warning! Dataset inaccurately uploaded. Try again.")
print(w)
},
finally = {
attr(x,"Spec_col")<-first.col:ncol(x)
attr(x, "Number of species")<-nrow(x)
attr(x,"Number of samples")<-ncol(x)-1
y<-unlist(lapply(as.list(first.col:ncol(x)),function(x1) is.numeric((x[,x1]))))
if(all(y, na.rm = TRUE)==F){
colbad<-which(y==FALSE) + first.col-1
cat(paste("Samples",paste(names(x)[colbad],collapse=","),"are not numeric"))
cat("\n")
answ=readline(prompt="Continue and skip non-numeric columns? y/n  ")
if(answ=="y") x<-x[-colbad] else stop(paste("Function was terminated. Try to fix the dataset."))
}
if(na2null==T) x[is.na(x)]<-0
if (attrib==T){
print("Attributes of table")
print(attributes(x))
}
cat(paste("Short data:"), "\n")
print(x[1:5,])
cat("\n")
message("You can continue.")
}
)
return(x)
}
LoadData()
data<-LoadData()
Abundance(data)
loadData<-function(file="clipboard",first.col=2, na2null=T, attrib=T) {
cat(paste("Copy data into cliboard."))
invisible(readline(prompt="Press [enter] to continue. "))
tryCatch(silent=T,
expr = {
x<-read.table(file, h=T, sep = "\t")
message("Dataset successfully uploaded.")
},
error = function(e){
message("Dataset inaccurately uploaded, Try again.")
print(e)
},
warning = function(w){
message("Warning! Dataset inaccurately uploaded. Try again.")
print(w)
},
finally = {
attr(x,"Spec_col")<-first.col:ncol(x)
attr(x, "Number of species")<-nrow(x)
attr(x,"Number of samples")<-ncol(x)-1
y<-unlist(lapply(as.list(first.col:ncol(x)),function(x1) is.numeric((x[,x1]))))
if(all(y, na.rm = TRUE)==F){
colbad<-which(y==FALSE) + first.col-1
cat(paste("Samples",paste(names(x)[colbad],collapse=","),"are not numeric"))
cat("\n")
answ=readline(prompt="Continue and skip non-numeric columns? y/n  ")
if(answ=="y") x<-x[-colbad] else stop(paste("Function was terminated. Try to fix the dataset."))
}
if(na2null==T) x[is.na(x)]<-0
if (attrib==T){
print("Attributes of table")
print(attributes(x))
}
cat(paste("Short data:"), "\n")
print(x[1:5,])
cat("\n")
message("You can continue.")
}
)
return(x)
}
loadData()
data<-loadData()
richness<-function(x, first.col = 2, graph = T, legh = 10, legl = 10, col = c("gray0", "gray48", "gray84"), ylab = "Number of species", ncol = 3, ...){
x<-x[,first.col:ncol(x)]
F1<-apply(x, 2, function(f1) sum(f1==1))
F2<-apply(x, 2, function(f2) sum(f2==2))
Other<-apply(x, 2, function(f4) sum(f4>2))
Total<-F1 + F2 + Other
SRtab<-rbind(F1,F2,Other,Total)
maxS<-max(SRtab[1,] + SRtab[2,])
maxS2<-max(SRtab[4,])
if (graph == T){
par(mfrow=c(1,1), mar=c(4,3,3,0.5), las = 2)
posgr = barplot(SRtab, plot = F)
barplot(SRtab[-4,], ylim = c(0,maxS2 + 5), ylab = ylab,
legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), col=col,
args.legend = list(bty = "n", x = legl, y = maxS2 + legh, ncol = ncol))
text(posgr, Total, lab=Total, cex=0.9, pos=3)
}
return(SRtab)
}
RI<-richness(data)
richness<-function(x, first.col = 2, graph = T, legh = 10, legl = 10, col = c("gray0", "gray48", "gray84"), ylab = "Number of species", ncol = 3, ...){
x<-x[,first.col:ncol(x)]
F1<-apply(x, 2, function(f1) sum(f1==1))
F2<-apply(x, 2, function(f2) sum(f2==2))
Other<-apply(x, 2, function(f4) sum(f4>2))
Total<-F1 + F2 + Other
SRtab<-rbind(F1,F2,Other,Total)
maxS<-max(SRtab[1,] + SRtab[2,])
maxS2<-max(SRtab[4,])
if (graph == T){
par(mfrow=c(1,1), mar=c(4,4,2,0.5), las = 2)
posgr = barplot(SRtab, plot = F)
barplot(SRtab[-4,], ylim = c(0,maxS2 + 5), ylab = ylab,
legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), col=col,
args.legend = list(bty = "n", x = legl, y = maxS2 + legh, ncol = ncol))
text(posgr, Total, lab=Total, cex=0.9, pos=3)
}
return(SRtab)
}
RI<-richness(data)
RI<-richness(data, legh = 15)
RI<-richness(data, legh = 8)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 + 30), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data)
Ab<-abundance(data, legh = 0)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 + 30), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data, legh = 0)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 + 30), col = col,
args.legend = list(bty = "n", x = legl, y = max(ylim) + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
# maxA2 + legh
return(Atab)
}
Ab<-abundance(data, legh = 0)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])), as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 + 30), col = col,
args.legend = list(bty = "n", x = legl, y = max(par("usr")) + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
# maxA2 + legh
return(Atab)
}
Ab<-abundance(data, legh = 0)
Ab<-abundance(data, legh = 100)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])),
as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 *1.1), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data, legh = 100)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])),
as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 * 1.5), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data, legh = 100)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,4,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])),
as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 * 1.2), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data, legh = 100)
abundance<-function(x, first.col = 2, graph = T, legh = 50, legl = 10, ylab = "Abundance",
col = c("gray0", "gray48", "gray84"), ...){
x<-x[,first.col:ncol(x)]
TotalA<-apply(x, 2, function(f5) sum(f5))
F1<-apply(x, 2, function(f1) sum(f1==1))
F2A<-apply(x, 2, function(f2) sum(f2==2))*2
OtherA<-TotalA-F1-F2A
Atab<-rbind(F1,F2A,OtherA,TotalA)
rownames(Atab)<-c("F1", "F2", "Other", "Total")
maxA<-max(Atab[1,] + Atab[2,])
maxA2<-max(Atab[4,])
print(maxA2)
if (graph == T){
par(mfrow=c(1,1), mar=c(3.85,4,1.5,0.5), las = 2)
posgr = barplot(Atab, plot = F)
barplot(Atab[-4,],legend.text = c(as.expression(bquote('F'['1'])),
as.expression(bquote('F'['2'])), "Other"), ylab = ylab, ylim = c(0, maxA2 * 1.2), col = col,
args.legend = list(bty = "n", x = legl, y = maxA2 + legh, ncol = 3), ...)
text(posgr, TotalA, lab = TotalA, cex = 0.9, pos = 3)
}
return(Atab)
}
Ab<-abundance(data, legh = 100)
dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 12,
textA = "Absolute proportion of species richness for classes of dominance.",
textB = "Relative proportion of species richness for classes of dominance.",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
if (table == 1){
table1 <-list( "Absolute proportion" = tableA, "Relative proportion" = tableR)
return(table1)
}
if (table == 2){
cat(paste(textA, "\n\n"))
return(tableA)
}
if (table == 3){
cat(paste(textB, "\n\n"))
return(tableR)
}
}
dominance<-function(x, first.col = 2, table = 1, graph = 1, legl = 12,
textA = "Absolute proportion of species richness for classes of dominance.",
textB = "Relative proportion of species richness for classes of dominance.",
textA1 = "Total number of species",
textB1 = "Relative frequency",
col = c("gray0","gray48","gray78", "gray84", "gray90"), bty = "n", ...){
calDom<-function(x) table(cut(x,breaks=c(0,2,5,12,40,100), labels = c("Sr", "R", "Sd.", "D", "E")))
tableA<-apply(x[-1],2,calDom)
tableR<-round(apply(tableA,2,function(tableA) tableA/sum(tableA)), digits = 2)
maxA<-max(apply(tableA, 2, function(x) sum(x))) # max in tableA
if (graph == 1){
par(mfrow=c(2,1), mar=c(3.8,4,2,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend=T,
args.legend = list(x = legl, y = -10, bty = bty, ncol = 6),
col = col, xaxt = "n")
barplot(tableR,ylab = textB1, legend=F,
col = col)
}
if (graph == 2){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableA, ylim = c(0,maxA + 5), ylab = textA1, legend = T,
args.legend = list(x = legl, y = maxA + 8, bty = bty, ncol = 6), col = col)
}
if (graph == 3){
par(mfrow=c(1,1), mar=c(3.8,4,4,1), las = 2)
barplot(tableR, legend=T,
args.legend = list(x = legl, y = 1.2, bty = bty, ncol = 1, ncol = 6),
col = col)
}
if (table == 1){
table1 <-list( "Absolute proportion" = tableA, "Relative proportion" = tableR)
return(table1)
}
if (table == 2){
cat(paste(textA, "\n\n"))
return(tableA)
}
if (table == 3){
cat(paste(textB, "\n\n"))
return(tableR)
}
}
DO<-dominance(data)
DO<-dominance(data)
DO
